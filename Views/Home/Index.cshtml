@{
    ViewBag.Title = "Home Page";
}

<div id="countDownBox">
    <h1 id="countDown"></h1>
</div>

<div id="missionDetailsBox" class="">
    <div>
        <button class="btn btn-primary" id="missionDetailsBtn">Mission Details</button>
    </div>
    <div>
        <p id="craftName"><strong>Rocket Name: </strong></p>
    </div>
    
</div>

@section scripts {
    
    <script>

        document.getElementById("missionDetailsBtn").addEventListener("click", missionDetails);

        function missionDetails() {
            var x = document.getElementById("missionDetailsBox");
            if (x.style.visibility === "hidden") {
                x.style.visibility = "visible";
            } else {
                x.style.visibility = "hidden"; 
            }
        }

        var url = "https://api.spacexdata.com/v3/launches/next";

        $(function () {
            $.getJSON(url).done(function (next) {
                //var nextLaunch = next.flight_number;
                var nextLaunch = next.launch_date_utc;
                document.getElementById("craftName").innerHTML += next.rocket.rocket_name;
                //console.log(next.rocket.rocket_name);

                var x = setInterval(function() {

                    // Get today's date and time
                    //var now = Math.round((new Date()).getTime() / 1000);
                    //var now = new Date().getUTCDate();
                    var now = new Date().getTime();
                    var countDownDate = new Date(nextLaunch).getTime();
                    

                    // Find the distance between now and the count down date
                    var distance = countDownDate - now;
    
                    // Time calculations for days, hours, minutes and seconds
                    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
                    // Output the result in an element with id="countDown"
                    document.getElementById("countDown").innerHTML = days + "d " + hours + "h "
                        + minutes + "m " + seconds + "s ";
                    console.log(now);

                    // If the count down is over or next launch is not loaded into API, display NO UPCOMING LAUNCHES
                    if (distance < 0) {
                        clearInterval(x);
                        document.getElementById("countDown").innerHTML = "NO UPCOMING LAUNCHES DETECTED";
                    }
                    // Update the count down every 1 second
                }, 1000);


            });
            
        });//end function block to get json data from the api and use it on screen


    </script>
    
    }